name: CI

on:
    push:
        branches: [main, master]
    pull_request:
        branches: [main, master]

jobs:
    lint-and-validate:
        name: Lint and Validate
        runs-on: ubuntu-latest

        strategy:
            matrix:
                node-version: [22.x]

        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Setup Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v4
              with:
                  node-version: ${{ matrix.node-version }}
                  cache: 'npm'

            - name: Install dependencies
              run: npm ci

            - name: Validate package.json
              run: npm pkg validate

            - name: Check Node.js version requirement
              run: |
                  node -e "const pkg = require('./package.json'); const required = pkg.engines.node.replace('>=', ''); const current = process.version; if (current < required) { console.error('Node.js version mismatch'); process.exit(1); }"
              continue-on-error: true

            - name: Verify file structure
              run: |
                  test -f package.json || exit 1
                  test -f src/index.js || exit 1
                  test -f src/utils/client.js || exit 1
                  test -f src/utils/formatters.js || exit 1
                  test -d src/commands || exit 1
                  echo "File structure validated"

            - name: Check for syntax errors
              run: |
                  node --check src/index.js
                  node --check src/utils/*.js
                  node --check src/commands/*.js
                  echo "Syntax check passed"
